<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Sample IDs and DUPs Export</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 5px;
    }
    th { background-color: #eee; }
    input.invalid { border: 2px solid red; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
  </style>
</head>
<body>
  <table id="dataTable">
    <tr>
      <th>Sample IDs</th>
      <th>UDPs</th>
    </tr>
    <tr>
      <td><input type="text" placeholder="SAMPLE-TAG" oninput="validateAll()"></td>
      <td><input type="text" placeholder="UDP0XXX" oninput="validateAll()"></td>
    </tr>
  </table>
  <br>
  <button onclick="addRow()">âž• Add Row</button>
  <button id="saveButton" onclick="saveFile()" disabled>ðŸ’¾ Save as TXT</button>

  <script>
    const samplePattern = /^[A-Za-z\-_]+$/;
    const udpPattern = /^UDP0*(\d{1,4})$/;

    function addRow() {
      const table = document.getElementById("dataTable");
      const row = table.insertRow(-1);
      row.insertCell(0).innerHTML = '<input type="text" placeholder="SAMPLE-TAG" oninput="validateAll()">';
      row.insertCell(1).innerHTML = '<input type="text" placeholder="UDP0XXX" oninput="validateAll()">';
      validateAll();
    }

    function validateAll() {
      const table = document.getElementById("dataTable");
      const saveButton = document.getElementById("saveButton");
      let valid = true;

      for (let i = 1; i < table.rows.length; i++) {
        const inputs = table.rows[i].getElementsByTagName("input");
        const sampleInput = inputs[0];
        const udpInput = inputs[1];

        // Validate Sample ID
        const sample = sampleInput.value.trim();
        if (sample && !samplePattern.test(sample)) {
          sampleInput.classList.add("invalid");
          valid = false;
        } else {
          sampleInput.classList.remove("invalid");
        }

        // Validate UDP
        const udp = udpInput.value.trim();
        let udpValid = false;
        if (udpPattern.test(udp)) {
          const num = parseInt(udp.match(udpPattern)[1]);
          udpValid = num >= 1 && num <= 192;
        }

        if (udp && !udpValid) {
          udpInput.classList.add("invalid");
          valid = false;
        } else {
          udpInput.classList.remove("invalid");
        }
      }

      saveButton.disabled = !valid;
    }

    function saveFile() {
      const table = document.getElementById("dataTable");
      let lines = [];
      lines.push("Sample IDs\tDUPs");

      for (let i = 1; i < table.rows.length; i++) {
        const inputs = table.rows[i].getElementsByTagName("input");
        const sample = inputs[0].value.trim();
        const udp = inputs[1].value.trim();
        lines.push(sample + "\t" + udp);
      }

      const blob = new Blob([lines.join("\n")], { type: "text/plain" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "samples_and_dups.txt"; // saved in default downloads folder
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
